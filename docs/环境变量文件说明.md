# 🔧 环境变量文件说明

## 📋 文件概览

| 文件名 | 用途 | 是否提交到Git | 说明 |
|--------|------|---------------|------|
| `env.example` | 配置模板 | ✅ 是 | 供其他开发者参考的配置模板 |
| `env.dev` | 开发环境配置 | ❌ 否 | 本地开发环境的具体配置 |
| `env.prod` | 生产环境配置 | ❌ 否 | 生产环境的具体配置 |

## 🔍 详细说明

### 1. `env.example` - 配置模板
**用途**: 为其他开发者提供配置参考
**特点**:
- 包含所有必要的环境变量
- 使用示例值，不包含真实敏感信息
- 必须提交到Git，供团队参考

### 2. `env.dev` - 开发环境配置
**用途**: 本地开发环境的具体配置
**特点**:
- 包含开发环境的真实配置值
- 可能包含敏感信息（密码、密钥等）
- 不被Git跟踪，每个开发者可以自定义

### 3. `env.prod` - 生产环境配置
**用途**: 生产环境的具体配置
**特点**:
- 包含生产环境的真实配置值
- 包含高度敏感信息
- 不被Git跟踪，只在生产服务器上存在

## 🔧 环境变量详解

### JWT配置
```bash
# JWT密钥 - 用于生成和验证JWT令牌
JWT_SECRET=your-super-secret-jwt-key-here-change-in-production

# JWT过期时间（小时）
JWT_EXPIRE_HOURS=24
```

### 数据库配置
```bash
# 数据库主机地址
DB_HOST=mysql-dev

# 数据库端口
DB_PORT=3306

# 数据库用户名
DB_USER=blog_user

# 数据库密码
DB_PASSWORD=your-secure-database-password

# 数据库名称
DB_NAME=sajuna_blog
```

### Redis配置
```bash
# Redis主机地址
REDIS_HOST=redis-dev

# Redis端口
REDIS_PORT=6379

# Redis密码（可选）
REDIS_PASSWORD=your-secure-redis-password
```

### 服务器配置
```bash
# 服务器端口
SERVER_PORT=8080

# Gin运行模式 (debug/release)
GIN_MODE=debug

# 信任的代理IP段
GIN_TRUSTED_PROXIES=172.18.0.0/16
```

### 安全配置
```bash
# bcrypt加密成本
BCRYPT_COST=12

# JWT过期时间（小时）
JWT_EXPIRE_HOURS=24
```

## 🚀 使用方法

### 1. 开发环境设置
```bash
# 1. 复制配置模板
cp env.example env.dev

# 2. 编辑开发环境配置
# 修改 env.dev 文件中的值

# 3. 启动开发环境
docker-compose -f docker-compose.dev.yml up -d
```

### 2. 生产环境设置
```bash
# 1. 复制配置模板
cp env.example env.prod

# 2. 编辑生产环境配置
# 修改 env.prod 文件中的值

# 3. 启动生产环境
docker-compose -f docker-compose.prod.yml up -d
```

### 3. 在Docker Compose中使用
```yaml
# docker-compose.yml
services:
  backend:
    environment:
      - JWT_SECRET=${JWT_SECRET}
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
```

## 🔒 安全注意事项

### 1. 敏感信息保护
- ❌ **不要**将包含真实密码的文件提交到Git
- ✅ **要**使用强密码和随机密钥
- ✅ **要**定期更换密钥和密码

### 2. 文件权限
```bash
# 设置适当的文件权限
chmod 600 env.dev
chmod 600 env.prod
```

### 3. 环境隔离
- 开发环境使用弱密码（便于开发）
- 生产环境使用强密码（确保安全）
- 不同环境使用不同的密钥

## 📝 配置示例

### 开发环境配置示例
```bash
# env.dev
JWT_SECRET=dev-secret-key-123
DB_PASSWORD=dev_password
REDIS_PASSWORD=
GIN_MODE=debug
```

### 生产环境配置示例
```bash
# env.prod
JWT_SECRET=super-secure-production-key-xyz789
DB_PASSWORD=VerySecurePassword123!
REDIS_PASSWORD=SecureRedisPass456!
GIN_MODE=release
```

## 🔧 在代码中使用环境变量

### Go后端使用
```go
// 读取环境变量
jwtSecret := os.Getenv("JWT_SECRET")
dbPassword := os.Getenv("DB_PASSWORD")

// 设置默认值
port := os.Getenv("SERVER_PORT")
if port == "" {
    port = "8080"
}
```

### Docker Compose使用
```yaml
services:
  backend:
    environment:
      - JWT_SECRET=${JWT_SECRET:-default-secret}
      - DB_PASSWORD=${DB_PASSWORD:-default-password}
```

## 🚨 常见问题

### 1. 环境变量未生效
- 检查文件路径是否正确
- 确认Docker Compose正确加载了环境变量
- 重启容器使配置生效

### 2. 敏感信息泄露
- 检查 `.gitignore` 是否包含 `env.dev` 和 `env.prod`
- 确认没有将敏感文件提交到Git
- 定期更换密钥和密码

### 3. 配置冲突
- 确保不同环境使用不同的配置文件
- 检查环境变量优先级（Docker Compose > 环境文件 > 默认值）

## 📋 最佳实践

1. **使用模板文件** - 始终从 `env.example` 开始
2. **环境隔离** - 不同环境使用不同配置
3. **安全第一** - 生产环境使用强密码
4. **版本控制** - 只提交模板文件，不提交真实配置
5. **文档记录** - 记录每个环境变量的用途
6. **定期更新** - 定期更换密钥和密码

## 🔍 检查清单

- [ ] 创建了 `env.dev` 文件
- [ ] 创建了 `env.prod` 文件
- [ ] 设置了强密码和密钥
- [ ] 确认 `.gitignore` 包含敏感文件
- [ ] 测试了环境变量加载
- [ ] 记录了配置说明
