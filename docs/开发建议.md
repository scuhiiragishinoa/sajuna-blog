# 🚀 Sajuna Blog 开发建议

## 📋 开发流程建议

### 1. 开发前准备
```bash
# 1. 启动开发环境
.\start.bat

# 2. 运行测试确保环境正常
.\scripts\test-dev.bat

# 3. 查看服务状态
docker-compose -f docker-compose.dev.yml ps
```

### 2. 日常开发流程
```bash
# 开发前
git pull origin main                    # 拉取最新代码
.\start.bat                            # 启动开发环境

# 开发中
# 修改代码 → 自动热重载
# 测试功能 → 浏览器访问 http://localhost:3000

# 开发后
git add .                              # 添加修改
git commit -m "feat: 添加新功能"        # 提交代码
git push origin feature-branch         # 推送分支
```

## 🎯 功能开发优先级

### 阶段1: 核心功能 (1-2周)
1. **用户认证系统**
   - 用户注册/登录
   - JWT令牌管理
   - 用户权限控制

2. **文章管理基础**
   - 文章CRUD操作
   - 文章分类管理
   - 文章标签管理

3. **基础UI界面**
   - 响应式布局
   - 文章列表页面
   - 文章详情页面

### 阶段2: 增强功能 (2-3周)
1. **内容管理**
   - Markdown编辑器
   - 图片上传功能
   - 文章搜索功能

2. **用户交互**
   - 评论系统
   - 点赞功能
   - 用户个人中心

3. **管理后台**
   - 管理员界面
   - 数据统计
   - 系统设置

### 阶段3: 高级功能 (3-4周)
1. **性能优化**
   - 缓存策略
   - 图片压缩
   - 懒加载

2. **SEO优化**
   - 元数据管理
   - 站点地图
   - 结构化数据

3. **部署优化**
   - 生产环境配置
   - 监控告警
   - 备份策略

## 🛠️ 技术开发建议

### 前端开发
```typescript
// 1. 使用TypeScript严格模式
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true
  }
}

// 2. 组件化开发
// components/ArticleCard.vue
<template>
  <div class="article-card">
    <h3>{{ article.title }}</h3>
    <p>{{ article.excerpt }}</p>
  </div>
</template>

// 3. 状态管理
// stores/article.ts
export const useArticleStore = defineStore('article', () => {
  const articles = ref<Article[]>([])
  const loading = ref(false)
  
  const fetchArticles = async () => {
    loading.value = true
    try {
      const response = await api.get('/articles')
      articles.value = response.data
    } finally {
      loading.value = false
    }
  }
  
  return { articles, loading, fetchArticles }
})
```

### 后端开发
```go
// 1. 错误处理
func CreateArticle(c *gin.Context) {
    var req CreateArticleRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, gin.H{"error": "请求参数错误"})
        return
    }
    
    // 业务逻辑
    article, err := articleService.Create(req)
    if err != nil {
        log.Printf("创建文章失败: %v", err)
        c.JSON(500, gin.H{"error": "服务器内部错误"})
        return
    }
    
    c.JSON(201, gin.H{"data": article})
}

// 2. 数据验证
type CreateArticleRequest struct {
    Title      string `json:"title" binding:"required,min=1,max=200"`
    Content    string `json:"content" binding:"required,min=1"`
    CategoryID uint64 `json:"category_id" binding:"required"`
    TagIDs     []uint64 `json:"tag_ids"`
}

// 3. 日志记录
log.Printf("用户 %d 创建文章: %s", userID, req.Title)
```

## 🔧 开发工具建议

### 1. 代码编辑器配置
```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "go.formatTool": "goimports"
}
```

### 2. Git工作流
```bash
# 功能分支开发
git checkout -b feature/user-authentication
git add .
git commit -m "feat: 添加用户认证功能"
git push origin feature/user-authentication

# 创建Pull Request
# 代码审查 → 合并到main分支
```

### 3. 调试工具
```bash
# 查看容器日志
docker-compose -f docker-compose.dev.yml logs -f backend-dev

# 进入容器调试
docker exec -it sajuna-blog-backend-dev sh
docker exec -it sajuna-blog-frontend-dev sh

# 数据库调试
.\scripts\db-connect.bat
```

## 📊 测试策略

### 1. 单元测试
```go
// backend/internal/handler/article_test.go
func TestCreateArticle(t *testing.T) {
    // 测试用例
    req := CreateArticleRequest{
        Title: "测试文章",
        Content: "测试内容",
    }
    
    // 执行测试
    // 验证结果
}
```

### 2. 集成测试
```bash
# 测试API接口
curl -X POST http://localhost:8080/api/v1/articles \
  -H "Content-Type: application/json" \
  -d '{"title":"测试文章","content":"测试内容"}'
```

### 3. 前端测试
```typescript
// frontend/src/components/__tests__/ArticleCard.test.ts
import { mount } from '@vue/test-utils'
import ArticleCard from '../ArticleCard.vue'

describe('ArticleCard', () => {
  it('renders article title', () => {
    const wrapper = mount(ArticleCard, {
      props: { article: { title: '测试标题' } }
    })
    expect(wrapper.text()).toContain('测试标题')
  })
})
```

## 🚀 性能优化建议

### 1. 前端优化
```typescript
// 1. 懒加载
const ArticleList = defineAsyncComponent(() => import('./ArticleList.vue'))

// 2. 虚拟滚动
import { VirtualList } from '@tanstack/vue-virtual'

// 3. 图片优化
<img 
  :src="article.cover" 
  loading="lazy"
  :alt="article.title"
/>
```

### 2. 后端优化
```go
// 1. 数据库查询优化
func GetArticles(page, size int) ([]Article, error) {
    var articles []Article
    err := db.Offset((page-1)*size).
        Limit(size).
        Preload("Category").
        Preload("Tags").
        Find(&articles).Error
    return articles, err
}

// 2. 缓存策略
func GetArticle(id uint64) (*Article, error) {
    // 先查缓存
    if cached := cache.Get(fmt.Sprintf("article:%d", id)); cached != nil {
        return cached.(*Article), nil
    }
    
    // 查数据库
    article, err := articleRepo.GetByID(id)
    if err != nil {
        return nil, err
    }
    
    // 写入缓存
    cache.Set(fmt.Sprintf("article:%d", id), article, 1*time.Hour)
    return article, nil
}
```

## 🔒 安全开发建议

### 1. 输入验证
```go
// 后端验证
func ValidateArticle(req *CreateArticleRequest) error {
    if len(req.Title) < 1 || len(req.Title) > 200 {
        return errors.New("标题长度必须在1-200字符之间")
    }
    
    // XSS防护
    req.Title = html.EscapeString(req.Title)
    req.Content = html.EscapeString(req.Content)
    
    return nil
}
```

### 2. 权限控制
```go
// 中间件验证
func AuthRequired() gin.HandlerFunc {
    return func(c *gin.Context) {
        token := c.GetHeader("Authorization")
        if token == "" {
            c.JSON(401, gin.H{"error": "未授权"})
            c.Abort()
            return
        }
        
        // 验证JWT
        claims, err := validateJWT(token)
        if err != nil {
            c.JSON(401, gin.H{"error": "令牌无效"})
            c.Abort()
            return
        }
        
        c.Set("user_id", claims.UserID)
        c.Next()
    }
}
```

## 📝 代码规范建议

### 1. 提交信息规范
```bash
# 格式: type(scope): description
feat(auth): 添加用户登录功能
fix(api): 修复文章创建接口错误
docs(readme): 更新安装说明
style(ui): 调整按钮样式
refactor(db): 重构数据库模型
test(api): 添加API测试用例
```

### 2. 代码注释
```go
// CreateArticle 创建文章
// @Summary 创建文章
// @Description 创建新的博客文章
// @Tags articles
// @Accept json
// @Produce json
// @Param article body CreateArticleRequest true "文章信息"
// @Success 201 {object} Article
// @Failure 400 {object} ErrorResponse
// @Router /api/v1/articles [post]
func CreateArticle(c *gin.Context) {
    // 实现代码
}
```

## 🎯 开发里程碑

### 第1周: 基础框架
- [ ] 用户注册/登录
- [ ] 文章CRUD
- [ ] 基础UI界面

### 第2周: 内容管理
- [ ] 分类和标签管理
- [ ] Markdown编辑器
- [ ] 图片上传

### 第3周: 用户交互
- [ ] 评论系统
- [ ] 搜索功能
- [ ] 用户个人中心

### 第4周: 优化部署
- [ ] 性能优化
- [ ] 生产环境配置
- [ ] 监控和日志

## 🚨 常见问题解决

### 1. 容器启动失败
```bash
# 查看日志
docker-compose -f docker-compose.dev.yml logs

# 重启服务
docker-compose -f docker-compose.dev.yml restart

# 清理重建
docker-compose -f docker-compose.dev.yml down -v
docker-compose -f docker-compose.dev.yml up -d --build
```

### 2. 数据库连接问题
```bash
# 检查数据库状态
docker exec sajuna-blog-mysql-dev mysql -u blog_user -pblog_password -e "SHOW DATABASES;"

# 重置数据库
docker-compose -f docker-compose.dev.yml down -v
docker-compose -f docker-compose.dev.yml up -d
```

### 3. 前端热重载失效
```bash
# 重启前端容器
docker-compose -f docker-compose.dev.yml restart frontend-dev

# 检查端口占用
netstat -an | findstr :3000
```

---

**🎉 祝您开发顺利！记住：小步快跑，持续迭代！**
